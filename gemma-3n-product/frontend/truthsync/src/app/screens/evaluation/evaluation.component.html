<div class="min-h-screen bg-gray-50">
  <!-- 헤더 -->
  <div class="bg-white shadow-sm px-4 py-3">
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <button (click)="goBack()" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center">
          <span class="material-icons text-gray-600">arrow_back</span>
        </button>
        <span class="font-bold text-xl text-gray-800">기사 평가</span>
      </div>
      <div class="flex items-center space-x-2">
        <div class="bg-blue-100 px-2 py-1 rounded-full">
          <span class="text-xs text-blue-600 font-medium">{{ currentLocation }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- 로딩 상태 -->
  <div *ngIf="isLoading" class="flex items-center justify-center py-12">
    <div class="text-center">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
      <p class="text-gray-600">평가 가능한 기사를 불러오는 중...</p>
    </div>
  </div>

  <!-- 평가 가능한 기사 목록 -->
  <div *ngIf="!isLoading && availablePosts.length > 0" class="p-4">
    <h2 class="text-lg font-semibold mb-4">평가할 기사 선택</h2>
    <div class="space-y-4">
      <div *ngFor="let post of availablePosts" 
           class="bg-white rounded-lg shadow-sm border p-4 cursor-pointer hover:shadow-md transition-shadow"
           [class.border-blue-500]="selectedPost?.id === post.id"
           (click)="selectPost(post)">
        
        <!-- 기사 정보 -->
        <div class="flex items-start space-x-3">
          <img [src]="post.image" alt="Post" class="w-16 h-16 object-cover rounded-lg">
          <div class="flex-1">
            <h3 class="font-semibold text-gray-900 mb-1">{{ post.headline }}</h3>
            <p class="text-sm text-gray-600 line-clamp-2">{{ post.content }}</p>
            <div class="flex items-center space-x-2 mt-2 text-xs text-gray-500">
              <span class="material-icons" style="font-size:14px;">location_on</span>
              <span>{{ post.location }} • {{ post.distance }}km</span>
              <span>•</span>
              <span>{{ post.timestamp }}</span>
            </div>
          </div>
          <div class="text-right">
            <div class="flex items-center space-x-1">
              <span class="material-icons text-yellow-500" style="font-size:16px;">star</span>
              <span class="font-bold text-lg">{{ post.verificationScore }}</span>
            </div>
            <span class="text-xs text-gray-500">진실도</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 평가할 기사가 없을 때 -->
  <div *ngIf="!isLoading && availablePosts.length === 0" class="flex flex-col items-center justify-center py-12 text-center text-gray-500">
    <span class="material-icons text-4xl text-gray-300 mb-4">rate_review</span>
    <h2 class="text-xl font-bold mb-2 text-gray-700">평가할 기사가 없습니다</h2>
    <p class="mb-4">현재 1km 반경 내에서 평가를 기다리는 기사가 없습니다.</p>
    <button (click)="goBack()" class="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium">
      홈으로 돌아가기
    </button>
  </div>

  <!-- 평가 폼 -->
  <div *ngIf="selectedPost" class="p-4">
    <div class="bg-white rounded-lg shadow-sm border p-6">
      <h3 class="text-lg font-semibold mb-4">기사 평가</h3>
      
      <!-- 선택된 기사 정보 -->
      <div class="mb-6 p-4 bg-gray-50 rounded-lg">
        <h4 class="font-medium text-gray-900 mb-2">{{ selectedPost.headline }}</h4>
        <p class="text-sm text-gray-600">{{ selectedPost.content }}</p>
        <div class="flex items-center space-x-2 mt-2 text-xs text-gray-500">
          <span class="material-icons" style="font-size:14px;">location_on</span>
          <span>{{ selectedPost.location }}</span>
        </div>
      </div>

      <!-- 품질 평가 -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-3">기사 품질 평가 (1-5점)</label>
        <div class="flex items-center space-x-2">
          <div *ngFor="let score of [1,2,3,4,5]" 
               class="flex flex-col items-center space-y-1">
            <button 
              (click)="onQualityChange(score)"
              class="w-12 h-12 rounded-full border-2 flex items-center justify-center transition-colors"
              [class.bg-blue-500]="qualityScore === score"
              [class.border-blue-500]="qualityScore === score"
              [class.bg-white]="qualityScore !== score"
              [class.border-gray-300]="qualityScore !== score">
              <span class="text-lg font-bold" 
                    [class.text-white]="qualityScore === score"
                    [class.text-gray-600]="qualityScore !== score">{{ score }}</span>
            </button>
            <span class="text-xs text-gray-500">{{ score }}점</span>
          </div>
        </div>
      </div>

      <!-- 게시 가능 여부 -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-3">게시 가능 여부</label>
        <div class="flex items-center space-x-3">
          <label class="flex items-center">
            <input type="radio" 
                   [checked]="isPublishable" 
                   (change)="isPublishable = true"
                   class="mr-2">
            <span class="text-sm">게시 가능</span>
          </label>
          <label class="flex items-center">
            <input type="radio" 
                   [checked]="!isPublishable" 
                   (change)="isPublishable = false"
                   class="mr-2">
            <span class="text-sm">게시 불가</span>
          </label>
        </div>
      </div>

      <!-- 평가 코멘트 -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">평가 코멘트 (선택사항)</label>
        <textarea
          [(ngModel)]="evaluationComment"
          placeholder="이 기사에 대한 의견을 자유롭게 작성해주세요..."
          class="w-full p-3 border border-gray-300 rounded-lg resize-none"
          rows="3"
          maxlength="500"></textarea>
        <div class="text-xs text-gray-500 mt-1 text-right">
          {{ evaluationComment.length }}/500
        </div>
      </div>

      <!-- 평가 제출 버튼 -->
      <div class="flex space-x-3">
        <button 
          (click)="submitEvaluation()"
          [disabled]="isLoading"
          class="flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium py-3 px-6 rounded-lg transition-colors">
          <span *ngIf="isLoading" class="animate-spin mr-2">⏳</span>
          {{ isLoading ? '평가 제출 중...' : '평가 제출' }}
        </button>
        <button 
          (click)="selectedPost = null"
          class="px-6 py-3 bg-gray-300 hover:bg-gray-400 text-gray-700 font-medium rounded-lg transition-colors">
          취소
        </button>
      </div>
    </div>
  </div>

  <!-- 평가 통계 -->
  <div *ngIf="selectedPost" class="p-4">
    <div class="bg-white rounded-lg shadow-sm border p-4">
      <h4 class="font-medium text-gray-900 mb-3">평가 통계</h4>
      <div class="grid grid-cols-2 gap-4 text-sm">
        <div class="text-center">
          <div class="text-2xl font-bold text-blue-600">{{ getEvaluationStats(selectedPost.id).totalEvaluations }}</div>
          <div class="text-gray-500">총 평가 수</div>
        </div>
        <div class="text-center">
          <div class="text-2xl font-bold text-green-600">{{ getEvaluationStats(selectedPost.id).averageQuality }}</div>
          <div class="text-gray-500">평균 품질</div>
        </div>
        <div class="text-center">
          <div class="text-2xl font-bold text-orange-600">{{ getEvaluationStats(selectedPost.id).publishableRate }}%</div>
          <div class="text-gray-500">게시 가능률</div>
        </div>
        <div class="text-center">
          <div class="text-2xl font-bold text-purple-600">{{ getEvaluationStats(selectedPost.id).averageDistance }}km</div>
          <div class="text-gray-500">평균 거리</div>
        </div>
      </div>
    </div>
  </div>
</div> 